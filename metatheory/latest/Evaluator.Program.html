<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Program Evaluators</title>
    <link rel="stylesheet" href="./Agda.css">
  </head>
  <body>
    <h1>Program Evaluators</h1>
    <section>
      <h1 id="evaluators-for-programs">Evaluators for Programs</h1>

<pre class="Agda"><a id="79" class="Keyword">module</a> <a id="86" href="Evaluator.Program.html" class="Module">Evaluator.Program</a> <a id="104" class="Keyword">where</a>
</pre>
<h2 id="imports">Imports</h2>

<pre class="Agda"><a id="131" class="Keyword">open</a> <a id="136" class="Keyword">import</a> <a id="143" href="Function.html" class="Module">Function</a> <a id="152" class="Keyword">using</a> <a id="158" class="Symbol">(</a><a id="159" href="Function.Base.html#1974" class="Function Operator">_$_</a><a id="162" class="Symbol">;</a><a id="163" href="Function.Base.html#1115" class="Function Operator">_∘_</a><a id="166" class="Symbol">)</a>
<a id="168" class="Keyword">open</a> <a id="173" class="Keyword">import</a> <a id="180" href="Data.String.html" class="Module">Data.String</a> <a id="192" class="Keyword">using</a> <a id="198" class="Symbol">(</a><a id="199" href="Agda.Builtin.String.html#335" class="Postulate">String</a><a id="205" class="Symbol">;</a><a id="206" href="Data.String.Base.html#2425" class="Function Operator">_++_</a><a id="210" class="Symbol">)</a>
<a id="212" class="Keyword">open</a> <a id="217" class="Keyword">import</a> <a id="224" href="Agda.Builtin.Nat.html" class="Module">Agda.Builtin.Nat</a>
<a id="241" class="Keyword">open</a> <a id="246" class="Keyword">import</a> <a id="253" href="Data.Product.html" class="Module">Data.Product</a> <a id="266" class="Keyword">using</a> <a id="272" class="Symbol">(</a><a id="273" href="Agda.Builtin.Sigma.html#165" class="Record">Σ</a><a id="274" class="Symbol">)</a> <a id="276" class="Keyword">renaming</a> <a id="285" class="Symbol">(</a><a id="286" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,_</a> <a id="290" class="Symbol">to</a> <a id="293" class="InductiveConstructor Operator">_,,_</a><a id="297" class="Symbol">)</a>
<a id="299" class="Keyword">open</a> <a id="304" class="Keyword">import</a> <a id="311" href="Data.Empty.html" class="Module">Data.Empty</a> <a id="322" class="Keyword">using</a> <a id="328" class="Symbol">(</a><a id="329" href="Data.Empty.html#914" class="Function">⊥</a><a id="330" class="Symbol">)</a>

<a id="333" class="Keyword">open</a> <a id="338" class="Keyword">import</a> <a id="345" href="Type.html" class="Module">Type</a> <a id="350" class="Keyword">using</a> <a id="356" class="Symbol">(</a><a id="357" href="Type.html#515" class="Datatype">Ctx⋆</a><a id="361" class="Symbol">;</a><a id="362" href="Type.html#534" class="InductiveConstructor">∅</a><a id="363" class="Symbol">;</a><a id="364" href="Type.html#545" class="InductiveConstructor Operator">_,⋆_</a><a id="368" class="Symbol">)</a>
<a id="370" class="Keyword">open</a> <a id="375" class="Keyword">import</a> <a id="382" href="Check.html" class="Module">Check</a> <a id="388" class="Keyword">using</a> <a id="394" class="Symbol">(</a><a id="395" href="Check.html#2131" class="Datatype">TypeError</a><a id="404" class="Symbol">;</a><a id="405" href="Check.html#17755" class="Function">inferType</a><a id="414" class="Symbol">;</a><a id="415" href="Check.html#8676" class="Function">inferKind</a><a id="424" class="Symbol">;</a><a id="425" href="Check.html#3308" class="Function">decKind</a><a id="432" class="Symbol">;</a><a id="433" href="Check.html#8600" class="Function">checkKind</a><a id="442" class="Symbol">;</a><a id="443" href="Check.html#17661" class="Function">checkType</a><a id="452" class="Symbol">)</a>
<a id="454" class="Keyword">open</a> <a id="459" href="Check.html#2131" class="Module">TypeError</a> <a id="469" class="Comment">-- Bring all TypeError constructors in scope.</a>

<a id="516" class="Keyword">open</a> <a id="521" class="Keyword">import</a> <a id="528" href="Scoped.Extrication.html" class="Module">Scoped.Extrication</a> <a id="547" class="Keyword">using</a> <a id="553" class="Symbol">(</a><a id="554" href="Scoped.Extrication.html#1316" class="Function">extricateNf⋆</a><a id="566" class="Symbol">;</a><a id="567" href="Scoped.Extrication.html#3031" class="Function">extricate</a><a id="576" class="Symbol">)</a>
<a id="578" class="Keyword">open</a> <a id="583" class="Keyword">import</a> <a id="590" href="Type.BetaNormal.html" class="Module">Type.BetaNormal</a> <a id="606" class="Keyword">using</a> <a id="612" class="Symbol">(</a><a id="613" href="Type.BetaNormal.html#1044" class="Datatype Operator">_⊢Nf⋆_</a><a id="619" class="Symbol">)</a>
<a id="621" class="Keyword">import</a> <a id="628" href="Untyped.html" class="Module">Untyped</a> <a id="636" class="Symbol">as</a> <a id="639" class="Module">U</a> <a id="641" class="Keyword">using</a> <a id="647" class="Symbol">(</a><a id="648" href="Untyped.html#1671" class="Datatype Operator">_⊢</a><a id="650" class="Symbol">;</a><a id="651" href="Untyped.html#6195" class="Function">scopeCheckU0</a><a id="663" class="Symbol">;</a><a id="664" href="Untyped.html#4888" class="Function">extricateU0</a><a id="675" class="Symbol">;</a><a id="676" href="Untyped.html#6378" class="Function">decUTm</a><a id="682" class="Symbol">)</a>
<a id="684" class="Keyword">import</a> <a id="691" href="Untyped.CEKWithCost.html" class="Module">Untyped.CEKWithCost</a> <a id="711" class="Symbol">as</a> <a id="714" class="Module">U</a> <a id="716" class="Keyword">using</a> <a id="722" class="Symbol">(</a><a id="723" href="Untyped.CEKWithCost.html#6609" class="Function">stepperC</a><a id="731" class="Symbol">)</a>
<a id="733" class="Keyword">open</a> <a id="738" class="Keyword">import</a> <a id="745" href="Cost.Base.html" class="Module">Cost.Base</a>
<a id="755" class="Keyword">open</a> <a id="760" class="Keyword">import</a> <a id="767" href="Cost.html" class="Module">Cost</a> <a id="772" class="Keyword">using</a> <a id="778" class="Symbol">(</a><a id="779" href="Cost.html#1956" class="Record">ExBudget</a><a id="787" class="Symbol">;</a><a id="788" href="Cost.html#4635" class="Function">machineParameters</a><a id="805" class="Symbol">;</a><a id="806" href="Cost.html#6828" class="Function">tallyingMachineParameters</a><a id="831" class="Symbol">;</a><a id="832" href="Cost.html#4849" class="Function">countingReport</a><a id="846" class="Symbol">;</a><a id="847" href="Cost.html#7079" class="Function">tallyingReport</a><a id="861" class="Symbol">;</a><a id="862" href="Cost.html#3595" class="Function">CostModel</a><a id="871" class="Symbol">)</a>
<a id="873" class="Keyword">open</a> <a id="878" class="Keyword">import</a> <a id="885" href="Cost.Raw.html" class="Module">Cost.Raw</a> <a id="894" class="Keyword">using</a> <a id="900" class="Symbol">(</a><a id="901" href="Cost.Raw.html#5784" class="Function">RawCostModel</a><a id="913" class="Symbol">)</a>
<a id="915" class="Keyword">open</a> <a id="920" class="Keyword">import</a> <a id="927" href="Cost.Model.html" class="Module">Cost.Model</a> <a id="938" class="Keyword">using</a> <a id="944" class="Symbol">(</a><a id="945" href="Cost.Model.html#9634" class="Function">createMap</a><a id="954" class="Symbol">)</a>
<a id="956" class="Keyword">import</a> <a id="963" href="RawU.html" class="Module">RawU</a> <a id="968" class="Symbol">as</a> <a id="971" class="Module">U</a> <a id="973" class="Keyword">using</a> <a id="979" class="Symbol">(</a><a id="980" href="RawU.html#6172" class="Datatype">Untyped</a><a id="987" class="Symbol">)</a>

<a id="990" class="Keyword">open</a> <a id="995" class="Keyword">import</a> <a id="1002" href="Untyped.CEK.html" class="Module">Untyped.CEK</a> <a id="1014" class="Symbol">as</a> <a id="1017" class="Module">U</a> <a id="1019" class="Keyword">using</a> <a id="1025" class="Symbol">(</a><a id="1026" href="Untyped.CEK.html#23742" class="Function">stepper</a><a id="1033" class="Symbol">;</a><a id="1034" href="Untyped.CEK.html#1256" class="Datatype">Stack</a><a id="1039" class="Symbol">;</a><a id="1040" href="Untyped.CEK.html#1286" class="InductiveConstructor">ε</a><a id="1041" class="Symbol">;</a><a id="1042" href="Untyped.CEK.html#1359" class="Datatype">Env</a><a id="1045" class="Symbol">;</a><a id="1046" href="Untyped.CEK.html#1383" class="InductiveConstructor">[]</a><a id="1048" class="Symbol">;</a><a id="1049" href="Untyped.CEK.html#3618" class="Datatype">State</a><a id="1054" class="Symbol">)</a>
<a id="1056" class="Keyword">open</a> <a id="1061" href="Untyped.CEK.html#3618" class="Module">U.State</a>

<a id="1070" class="Keyword">open</a> <a id="1075" class="Keyword">import</a> <a id="1082" href="Raw.html" class="Module">Raw</a> <a id="1086" class="Keyword">using</a> <a id="1092" class="Symbol">(</a><a id="1093" href="Raw.html#1435" class="Datatype">RawTm</a><a id="1098" class="Symbol">;</a><a id="1099" href="Raw.html#810" class="Datatype">RawTy</a><a id="1104" class="Symbol">;</a><a id="1105" href="Raw.html#5734" class="Function">rawPrinter</a><a id="1115" class="Symbol">;</a><a id="1116" href="Raw.html#4705" class="Function">rawTyPrinter</a><a id="1128" class="Symbol">;</a><a id="1129" href="Raw.html#2639" class="Function">decRTy</a><a id="1135" class="Symbol">;</a><a id="1136" href="Raw.html#3452" class="Function">decRTm</a><a id="1142" class="Symbol">)</a>
<a id="1144" class="Keyword">open</a> <a id="1149" class="Keyword">import</a> <a id="1156" href="Scoped.html" class="Module">Scoped</a> <a id="1163" class="Keyword">using</a> <a id="1169" class="Symbol">(</a><a id="1170" href="Scoped.html#7729" class="Postulate">FreeVariableError</a><a id="1187" class="Symbol">;</a><a id="1188" href="Scoped.html#7824" class="Datatype">ScopeError</a><a id="1198" class="Symbol">;</a><a id="1199" href="Scoped.html#7873" class="InductiveConstructor">freeVariableError</a><a id="1216" class="Symbol">;</a><a id="1217" href="Scoped.html#10960" class="Function">extricateScopeTy</a><a id="1233" class="Symbol">;</a><a id="1234" href="Scoped.html#6896" class="Datatype">ScopedTm</a><a id="1242" class="Symbol">;</a><a id="1243" href="Scoped.html#1414" class="Datatype">Weirdℕ</a><a id="1249" class="Symbol">;</a><a id="1250" href="Scoped.html#9725" class="Function">scopeCheckTm</a><a id="1262" class="Symbol">;</a><a id="1263" href="Scoped.html#4359" class="Function">shifter</a><a id="1270" class="Symbol">;</a><a id="1271" href="Scoped.html#6018" class="Function">unshifter</a><a id="1280" class="Symbol">;</a><a id="1281" href="Scoped.html#11939" class="Function">extricateScope</a><a id="1295" class="Symbol">;</a><a id="1296" href="Scoped.html#5193" class="Function">unshifterTy</a><a id="1307" class="Symbol">;</a><a id="1308" href="Scoped.html#8556" class="Function">scopeCheckTy</a><a id="1320" class="Symbol">;</a><a id="1321" href="Scoped.html#3558" class="Function">shifterTy</a><a id="1330" class="Symbol">)</a>
<a id="1332" class="Keyword">open</a> <a id="1337" href="Scoped.html#1414" class="Module">Weirdℕ</a> <a id="1344" class="Comment">-- Bring Weirdℕ constructors in scope</a>
<a id="1382" class="Keyword">open</a> <a id="1387" class="Keyword">import</a> <a id="1394" href="Utils.html" class="Module">Utils</a> <a id="1400" class="Keyword">using</a> <a id="1406" class="Symbol">(</a><a id="1407" href="Utils.html#1125" class="Datatype">Either</a><a id="1413" class="Symbol">;</a><a id="1414" href="Utils.html#1158" class="InductiveConstructor">inj₁</a><a id="1418" class="Symbol">;</a><a id="1419" href="Utils.html#1182" class="InductiveConstructor">inj₂</a><a id="1423" class="Symbol">;</a><a id="1424" href="Utils.html#3696" class="Function">withE</a><a id="1429" class="Symbol">;</a><a id="1430" href="Utils.html#7297" class="Datatype">Kind</a><a id="1434" class="Symbol">;</a><a id="1435" href="Utils.html#7316" class="InductiveConstructor">*</a><a id="1436" class="Symbol">;</a><a id="1437" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a><a id="1442" class="Symbol">;</a><a id="1443" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="1450" class="Symbol">;</a><a id="1451" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a><a id="1455" class="Symbol">;</a><a id="1456" href="Utils.html#2862" class="Record">Monad</a><a id="1461" class="Symbol">;</a><a id="1462" href="Utils.html#4355" class="Datatype">RuntimeError</a><a id="1474" class="Symbol">;</a><a id="1475" href="Utils.html#3811" class="Function">dec2Either</a><a id="1485" class="Symbol">;</a><a id="1486" href="Utils.html#4001" class="InductiveConstructor Operator">_,_</a><a id="1489" class="Symbol">)</a>
<a id="1491" class="Keyword">open</a> <a id="1496" href="Utils.html#4355" class="Module">RuntimeError</a>
<a id="1509" class="Keyword">open</a> <a id="1514" href="Utils.html#2862" class="Module">Monad</a> <a id="1520" class="Symbol"></a>

<a id="1529" class="Keyword">open</a> <a id="1534" class="Keyword">import</a> <a id="1541" href="Algorithmic.html" class="Module">Algorithmic</a> <a id="1553" class="Keyword">using</a> <a id="1559" class="Symbol">(</a><a id="1560" href="Algorithmic.html#5277" class="Datatype Operator">_⊢_</a><a id="1563" class="Symbol">;</a><a id="1564" href="Algorithmic.html#1667" class="InductiveConstructor">∅</a><a id="1565" class="Symbol">;</a><a id="1566" href="Algorithmic.html#7621" class="InductiveConstructor">error</a><a id="1571" class="Symbol">)</a>

<a id="1574" class="Keyword">open</a> <a id="1579" class="Keyword">import</a> <a id="1586" href="Algorithmic.CK.html" class="Module">Algorithmic.CK</a> <a id="1601" class="Keyword">using</a> <a id="1607" class="Symbol">(</a><a id="1608" href="Algorithmic.CK.html#4610" class="Function">stepper</a><a id="1615" class="Symbol">;</a><a id="1616" href="Algorithmic.CK.html#1313" class="Datatype">State</a><a id="1621" class="Symbol">;</a><a id="1622" href="Algorithmic.CK.html#1126" class="Datatype">Stack</a><a id="1627" class="Symbol">;</a><a id="1628" href="Algorithmic.CK.html#1177" class="InductiveConstructor">ε</a><a id="1629" class="Symbol">)</a>
<a id="1631" class="Keyword">open</a> <a id="1636" href="Algorithmic.CK.html#1313" class="Module">Algorithmic.CK.State</a>

<a id="1658" class="Keyword">open</a> <a id="1663" class="Keyword">import</a> <a id="1670" href="Algorithmic.CEK.html" class="Module">Algorithmic.CEK</a> <a id="1686" class="Keyword">using</a> <a id="1692" class="Symbol">(</a><a id="1693" href="Algorithmic.CEK.html#19925" class="Function">stepper</a><a id="1700" class="Symbol">;</a><a id="1701" href="Algorithmic.CEK.html#17530" class="Datatype">State</a><a id="1706" class="Symbol">;</a><a id="1707" href="Algorithmic.CEK.html#17399" class="Datatype">Stack</a><a id="1712" class="Symbol">;</a><a id="1713" href="Algorithmic.CEK.html#17451" class="InductiveConstructor">ε</a><a id="1714" class="Symbol">;</a><a id="1715" href="Algorithmic.CEK.html#1843" class="Datatype">Env</a><a id="1718" class="Symbol">;</a><a id="1719" href="Algorithmic.CEK.html#3836" class="InductiveConstructor">[]</a><a id="1721" class="Symbol">)</a>
<a id="1723" class="Keyword">open</a> <a id="1728" href="Algorithmic.CEK.html#17530" class="Module">Algorithmic.CEK.State</a>

<a id="1751" class="Keyword">open</a> <a id="1756" class="Keyword">import</a> <a id="1763" href="Algorithmic.Erasure.html" class="Module">Algorithmic.Erasure</a> <a id="1783" class="Keyword">using</a> <a id="1789" class="Symbol">(</a><a id="1790" href="Algorithmic.Erasure.html#2235" class="Function">erase</a><a id="1795" class="Symbol">)</a>
<a id="1797" class="Keyword">import</a> <a id="1804" href="Algorithmic.Evaluation.html" class="Module">Algorithmic.Evaluation</a> <a id="1827" class="Symbol">as</a> <a id="1830" class="Module">L</a> <a id="1832" class="Keyword">using</a><a id="1837" class="Symbol">(</a><a id="1838" href="Algorithmic.Evaluation.html#2112" class="Function">stepper</a><a id="1845" class="Symbol">)</a>

<a id="1848" class="Keyword">open</a> <a id="1853" class="Keyword">import</a> <a id="1860" href="Evaluator.Base.html" class="Module">Evaluator.Base</a> <a id="1875" class="Keyword">using</a> <a id="1881" class="Symbol">(</a><a id="1882" href="Evaluator.Base.html#1239" class="Datatype">ERROR</a><a id="1887" class="Symbol">;</a><a id="1888" href="Evaluator.Base.html#1460" class="Function">uglyTypeError</a><a id="1901" class="Symbol">;</a><a id="1902" href="Evaluator.Base.html#3060" class="Function">maxsteps</a><a id="1910" class="Symbol">;</a><a id="1911" href="Evaluator.Base.html#799" class="Postulate">prettyPrintUTm</a><a id="1925" class="Symbol">;</a><a id="1926" href="Evaluator.Base.html#732" class="Postulate">prettyPrintTm</a><a id="1939" class="Symbol">;</a><a id="1940" href="Evaluator.Base.html#765" class="Postulate">prettyPrintTy</a><a id="1953" class="Symbol">;</a><a id="1954" href="Evaluator.Base.html#487" class="Postulate">ParseError</a><a id="1964" class="Symbol">)</a>
<a id="1966" class="Keyword">open</a> <a id="1971" href="Evaluator.Base.html#1239" class="Module">ERROR</a>
</pre>
<h2 id="imports-from-haskell">Imports from Haskell</h2>

<pre class="Agda"><a id="2011" class="Symbol">{-#</a> <a id="2015" class="Keyword">FOREIGN</a> <a id="2023" class="Pragma">GHC</a> <a id="2027" class="Pragma">import</a> <a id="2034" class="Pragma">PlutusCore.Executable.Common</a>  <a id="2064" class="Symbol">#-}</a>
<a id="2068" class="Symbol">{-#</a> <a id="2072" class="Keyword">FOREIGN</a> <a id="2080" class="Pragma">GHC</a> <a id="2084" class="Pragma">import</a> <a id="2091" class="Pragma">PlutusCore.Executable.Parsers</a> <a id="2121" class="Symbol">#-}</a>

<a id="2126" class="Keyword">postulate</a>
   <a id="Format"></a><a id="2139" href="Evaluator.Program.html#2139" class="Postulate">Format</a> <a id="2146" class="Symbol">:</a> <a id="2148" href="Agda.Primitive.html#388" class="Primitive">Set</a>
   <a id="Input"></a><a id="2155" href="Evaluator.Program.html#2155" class="Postulate">Input</a> <a id="2161" class="Symbol">:</a> <a id="2163" href="Agda.Primitive.html#388" class="Primitive">Set</a>

<a id="2168" class="Symbol">{-#</a> <a id="2172" class="Keyword">COMPILE</a> <a id="2180" class="Keyword">GHC</a> <a id="2184" href="Evaluator.Program.html#2139" class="Postulate">Format</a> <a id="2191" class="Pragma">=</a> <a id="2193" class="Pragma">type</a> <a id="2198" class="Pragma">Format</a> <a id="2205" class="Symbol">#-}</a>
<a id="2209" class="Symbol">{-#</a> <a id="2213" class="Keyword">COMPILE</a> <a id="2221" class="Keyword">GHC</a> <a id="2225" href="Evaluator.Program.html#2155" class="Postulate">Input</a> <a id="2231" class="Pragma">=</a> <a id="2233" class="Pragma">type</a> <a id="2238" class="Pragma">Input</a> <a id="2244" class="Symbol">#-}</a>

<a id="2249" class="Keyword">postulate</a>
  <a id="ProgramN"></a><a id="2261" href="Evaluator.Program.html#2261" class="Postulate">ProgramN</a> <a id="2270" class="Symbol">:</a> <a id="2272" href="Agda.Primitive.html#388" class="Primitive">Set</a>
  <a id="Program"></a><a id="2278" href="Evaluator.Program.html#2278" class="Postulate">Program</a> <a id="2286" class="Symbol">:</a> <a id="2288" href="Agda.Primitive.html#388" class="Primitive">Set</a>
  <a id="convP"></a><a id="2294" href="Evaluator.Program.html#2294" class="Postulate">convP</a> <a id="2300" class="Symbol">:</a> <a id="2302" href="Evaluator.Program.html#2278" class="Postulate">Program</a> <a id="2310" class="Symbol">→</a> <a id="2312" href="Raw.html#1435" class="Datatype">RawTm</a>
  <a id="deBruijnify"></a><a id="2320" href="Evaluator.Program.html#2320" class="Postulate">deBruijnify</a> <a id="2332" class="Symbol">:</a> <a id="2334" href="Evaluator.Program.html#2261" class="Postulate">ProgramN</a> <a id="2343" class="Symbol">→</a> <a id="2345" href="Utils.html#1125" class="Datatype">Either</a> <a id="2352" href="Scoped.html#7729" class="Postulate">FreeVariableError</a> <a id="2370" href="Evaluator.Program.html#2278" class="Postulate">Program</a>

  <a id="ProgramNU"></a><a id="2381" href="Evaluator.Program.html#2381" class="Postulate">ProgramNU</a> <a id="2391" class="Symbol">:</a> <a id="2393" href="Agda.Primitive.html#388" class="Primitive">Set</a>
  <a id="ProgramU"></a><a id="2399" href="Evaluator.Program.html#2399" class="Postulate">ProgramU</a> <a id="2408" class="Symbol">:</a> <a id="2410" href="Agda.Primitive.html#388" class="Primitive">Set</a>
  <a id="deBruijnifyU"></a><a id="2416" href="Evaluator.Program.html#2416" class="Postulate">deBruijnifyU</a> <a id="2429" class="Symbol">:</a> <a id="2431" href="Evaluator.Program.html#2381" class="Postulate">ProgramNU</a> <a id="2441" class="Symbol">→</a> <a id="2443" href="Utils.html#1125" class="Datatype">Either</a> <a id="2450" href="Scoped.html#7729" class="Postulate">FreeVariableError</a> <a id="2468" href="Evaluator.Program.html#2399" class="Postulate">ProgramU</a>
  <a id="convPU"></a><a id="2479" href="Evaluator.Program.html#2479" class="Postulate">convPU</a> <a id="2486" class="Symbol">:</a> <a id="2488" href="Evaluator.Program.html#2399" class="Postulate">ProgramU</a> <a id="2497" class="Symbol">→</a> <a id="2499" href="RawU.html#6172" class="Datatype">U.Untyped</a>

<a id="2510" class="Symbol">{-#</a> <a id="2514" class="Keyword">FOREIGN</a> <a id="2522" class="Pragma">GHC</a> <a id="2526" class="Pragma">import</a> <a id="2533" class="Pragma">PlutusCore.DeBruijn</a> <a id="2553" class="Symbol">#-}</a>
<a id="2557" class="Symbol">{-#</a> <a id="2561" class="Keyword">FOREIGN</a> <a id="2569" class="Pragma">GHC</a> <a id="2573" class="Pragma">import</a> <a id="2580" class="Pragma">qualified</a> <a id="2590" class="Pragma">UntypedPlutusCore</a> <a id="2608" class="Pragma">as</a> <a id="2611" class="Pragma">U</a> <a id="2613" class="Symbol">#-}</a>
<a id="2617" class="Symbol">{-#</a> <a id="2621" class="Keyword">FOREIGN</a> <a id="2629" class="Pragma">GHC</a> <a id="2633" class="Pragma">import</a> <a id="2640" class="Pragma">qualified</a> <a id="2650" class="Pragma">UntypedPlutusCore.Parser</a> <a id="2675" class="Pragma">as</a> <a id="2678" class="Pragma">U</a> <a id="2680" class="Symbol">#-}</a>
<a id="2684" class="Symbol">{-#</a> <a id="2688" class="Keyword">FOREIGN</a> <a id="2696" class="Pragma">GHC</a> <a id="2700" class="Pragma">import</a> <a id="2707" class="Pragma">qualified</a> <a id="2717" class="Pragma">Untyped</a> <a id="2725" class="Pragma">as</a> <a id="2728" class="Pragma">U</a> <a id="2730" class="Symbol">#-}</a>
<a id="2734" class="Symbol">{-#</a> <a id="2738" class="Keyword">FOREIGN</a> <a id="2746" class="Pragma">GHC</a> <a id="2750" class="Pragma">import</a> <a id="2757" class="Pragma">Raw</a> <a id="2761" class="Symbol">#-}</a>
<a id="2765" class="Symbol">{-#</a> <a id="2769" class="Keyword">FOREIGN</a> <a id="2777" class="Pragma">GHC</a> <a id="2781" class="Pragma">import</a> <a id="2788" class="Pragma">PlutusCore</a> <a id="2799" class="Symbol">#-}</a>
<a id="2803" class="Symbol">{-#</a> <a id="2807" class="Keyword">FOREIGN</a> <a id="2815" class="Pragma">GHC</a> <a id="2819" class="Pragma">import</a> <a id="2826" class="Pragma">Data.Bifunctor</a> <a id="2841" class="Symbol">#-}</a>
<a id="2845" class="Symbol">{-#</a> <a id="2849" class="Keyword">FOREIGN</a> <a id="2857" class="Pragma">GHC</a> <a id="2861" class="Pragma">import</a> <a id="2868" class="Pragma">Data.Functor</a> <a id="2881" class="Symbol">#-}</a>
<a id="2885" class="Symbol">{-#</a> <a id="2889" class="Keyword">FOREIGN</a> <a id="2897" class="Pragma">GHC</a> <a id="2901" class="Pragma">import</a> <a id="2908" class="Pragma">Data.Either</a> <a id="2920" class="Symbol">#-}</a>
<a id="2924" class="Symbol">{-#</a> <a id="2928" class="Keyword">FOREIGN</a> <a id="2936" class="Pragma">GHC</a> <a id="2940" class="Pragma">import</a> <a id="2947" class="Pragma">Control.Monad.Trans.Except</a> <a id="2974" class="Symbol">#-}</a>

<a id="2979" class="Symbol">{-#</a> <a id="2983" class="Keyword">COMPILE</a> <a id="2991" class="Keyword">GHC</a> <a id="2995" href="Evaluator.Program.html#2261" class="Postulate">ProgramN</a> <a id="3004" class="Pragma">=</a> <a id="3006" class="Pragma">type</a> <a id="3011" class="Pragma">PlutusCore.Program</a> <a id="3030" class="Pragma">TyName</a> <a id="3037" class="Pragma">Name</a> <a id="3042" class="Pragma">DefaultUni</a> <a id="3053" class="Pragma">DefaultFun</a> <a id="3064" class="Pragma">PlutusCore.SrcSpan</a> <a id="3083" class="Symbol">#-}</a>
<a id="3087" class="Symbol">{-#</a> <a id="3091" class="Keyword">COMPILE</a> <a id="3099" class="Keyword">GHC</a> <a id="3103" href="Evaluator.Program.html#2278" class="Postulate">Program</a> <a id="3111" class="Pragma">=</a> <a id="3113" class="Pragma">type</a> <a id="3118" class="Pragma">PlutusCore.Program</a> <a id="3137" class="Pragma">NamedTyDeBruijn</a> <a id="3153" class="Pragma">NamedDeBruijn</a> <a id="3167" class="Pragma">DefaultUni</a> <a id="3178" class="Pragma">DefaultFun</a> <a id="3189" class="Pragma">()</a> <a id="3192" class="Symbol">#-}</a>
<a id="3196" class="Symbol">{-#</a> <a id="3200" class="Keyword">COMPILE</a> <a id="3208" class="Keyword">GHC</a> <a id="3212" href="Evaluator.Program.html#2294" class="Postulate">convP</a> <a id="3218" class="Pragma">=</a> <a id="3220" class="Pragma">convP</a> <a id="3226" class="Symbol">#-}</a>
<a id="3230" class="Symbol">{-#</a> <a id="3234" class="Keyword">COMPILE</a> <a id="3242" class="Keyword">GHC</a> <a id="3246" href="Evaluator.Program.html#2320" class="Postulate">deBruijnify</a> <a id="3258" class="Pragma">=</a> <a id="3260" class="Pragma">\</a> <a id="3262" class="Pragma">(Program</a> <a id="3271" class="Pragma">ann</a> <a id="3275" class="Pragma">ver</a> <a id="3279" class="Pragma">tm)</a> <a id="3283" class="Pragma">-&gt;</a> <a id="3286" class="Pragma">second</a> <a id="3293" class="Pragma">(void</a> <a id="3299" class="Pragma">.</a> <a id="3301" class="Pragma">Program</a> <a id="3309" class="Pragma">ann</a> <a id="3313" class="Pragma">ver)</a> <a id="3318" class="Pragma">.</a> <a id="3320" class="Pragma">runExcept</a> <a id="3330" class="Pragma">$</a> <a id="3332" class="Pragma">deBruijnTerm</a> <a id="3345" class="Pragma">tm</a> <a id="3348" class="Symbol">#-}</a>

<a id="3353" class="Symbol">{-#</a> <a id="3357" class="Keyword">COMPILE</a> <a id="3365" class="Keyword">GHC</a> <a id="3369" href="Evaluator.Program.html#2381" class="Postulate">ProgramNU</a> <a id="3379" class="Pragma">=</a> <a id="3381" class="Pragma">type</a> <a id="3386" class="Pragma">U.Program</a> <a id="3396" class="Pragma">Name</a> <a id="3401" class="Pragma">DefaultUni</a> <a id="3412" class="Pragma">DefaultFun</a> <a id="3423" class="Pragma">PlutusCore.SrcSpan</a> <a id="3442" class="Symbol">#-}</a>
<a id="3446" class="Symbol">{-#</a> <a id="3450" class="Keyword">COMPILE</a> <a id="3458" class="Keyword">GHC</a> <a id="3462" href="Evaluator.Program.html#2399" class="Postulate">ProgramU</a> <a id="3471" class="Pragma">=</a> <a id="3473" class="Pragma">type</a> <a id="3478" class="Pragma">U.Program</a> <a id="3488" class="Pragma">NamedDeBruijn</a> <a id="3502" class="Pragma">DefaultUni</a> <a id="3513" class="Pragma">DefaultFun</a> <a id="3524" class="Pragma">()</a> <a id="3527" class="Symbol">#-}</a>
<a id="3531" class="Symbol">{-#</a> <a id="3535" class="Keyword">COMPILE</a> <a id="3543" class="Keyword">GHC</a> <a id="3547" href="Evaluator.Program.html#2416" class="Postulate">deBruijnifyU</a> <a id="3560" class="Pragma">=</a> <a id="3562" class="Pragma">\</a> <a id="3564" class="Pragma">(U.Program</a> <a id="3575" class="Pragma">ann</a> <a id="3579" class="Pragma">ver</a> <a id="3583" class="Pragma">tm)</a> <a id="3587" class="Pragma">-&gt;</a> <a id="3590" class="Pragma">second</a> <a id="3597" class="Pragma">(void</a> <a id="3603" class="Pragma">.</a> <a id="3605" class="Pragma">U.Program</a> <a id="3615" class="Pragma">ann</a> <a id="3619" class="Pragma">ver)</a> <a id="3624" class="Pragma">.</a> <a id="3626" class="Pragma">runExcept</a> <a id="3636" class="Pragma">$</a> <a id="3638" class="Pragma">U.deBruijnTerm</a> <a id="3653" class="Pragma">tm</a> <a id="3656" class="Symbol">#-}</a>
<a id="3660" class="Symbol">{-#</a> <a id="3664" class="Keyword">COMPILE</a> <a id="3672" class="Keyword">GHC</a> <a id="3676" href="Evaluator.Program.html#2479" class="Postulate">convPU</a> <a id="3683" class="Pragma">=</a> <a id="3685" class="Pragma">U.convP</a> <a id="3693" class="Symbol">#-}</a>

<a id="3698" class="Symbol">{-#</a> <a id="3702" class="Keyword">FOREIGN</a> <a id="3710" class="Pragma">GHC</a> <a id="3714" class="Pragma">import</a> <a id="3721" class="Pragma">Opts</a> <a id="3726" class="Symbol">#-}</a>
</pre>
<h2 id="evaluators">Evaluators</h2>

<pre class="Agda"><a id="3754" class="Keyword">data</a> <a id="BudgetMode"></a><a id="3759" href="Evaluator.Program.html#3759" class="Datatype">BudgetMode</a> <a id="3770" class="Symbol">(</a><a id="3771" href="Evaluator.Program.html#3771" class="Bound">A</a> <a id="3773" class="Symbol">:</a> <a id="3775" href="Agda.Primitive.html#388" class="Primitive">Set</a><a id="3778" class="Symbol">)</a> <a id="3780" class="Symbol">:</a> <a id="3782" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="3786" class="Keyword">where</a>
  <a id="BudgetMode.Silent"></a><a id="3794" href="Evaluator.Program.html#3794" class="InductiveConstructor">Silent</a>   <a id="3803" class="Symbol">:</a> <a id="3805" href="Evaluator.Program.html#3759" class="Datatype">BudgetMode</a> <a id="3816" href="Evaluator.Program.html#3771" class="Bound">A</a>
  <a id="BudgetMode.Counting"></a><a id="3820" href="Evaluator.Program.html#3820" class="InductiveConstructor">Counting</a> <a id="3829" class="Symbol">:</a> <a id="3831" href="Evaluator.Program.html#3771" class="Bound">A</a> <a id="3833" class="Symbol">→</a> <a id="3835" href="Evaluator.Program.html#3759" class="Datatype">BudgetMode</a> <a id="3846" href="Evaluator.Program.html#3771" class="Bound">A</a>
  <a id="BudgetMode.Tallying"></a><a id="3850" href="Evaluator.Program.html#3850" class="InductiveConstructor">Tallying</a> <a id="3859" class="Symbol">:</a> <a id="3861" href="Evaluator.Program.html#3771" class="Bound">A</a> <a id="3863" class="Symbol">→</a> <a id="3865" href="Evaluator.Program.html#3759" class="Datatype">BudgetMode</a> <a id="3876" href="Evaluator.Program.html#3771" class="Bound">A</a>

<a id="3879" class="Symbol">{-#</a> <a id="3883" class="Keyword">COMPILE</a> <a id="3891" class="Keyword">GHC</a> <a id="3895" href="Evaluator.Program.html#3759" class="Datatype">BudgetMode</a> <a id="3906" class="Pragma">=</a> <a id="3908" class="Pragma">data</a> <a id="3913" class="Pragma">BudgetMode</a> <a id="3924" class="Pragma">(Silent</a> <a id="3932" class="Pragma">|</a> <a id="3934" class="Pragma">Counting</a> <a id="3943" class="Pragma">|</a> <a id="3945" class="Pragma">Tallying)</a> <a id="3955" class="Symbol">#-}</a>

<a id="3960" class="Keyword">data</a> <a id="EvalMode"></a><a id="3965" href="Evaluator.Program.html#3965" class="Datatype">EvalMode</a> <a id="3974" class="Symbol">:</a> <a id="3976" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="3980" class="Keyword">where</a>
  <a id="EvalMode.U"></a><a id="3988" href="Evaluator.Program.html#3988" class="InductiveConstructor">U</a> <a id="EvalMode.TL"></a><a id="3990" href="Evaluator.Program.html#3990" class="InductiveConstructor">TL</a> <a id="EvalMode.TCK"></a><a id="3993" href="Evaluator.Program.html#3993" class="InductiveConstructor">TCK</a> <a id="EvalMode.TCEK"></a><a id="3997" href="Evaluator.Program.html#3997" class="InductiveConstructor">TCEK</a> <a id="4002" class="Symbol">:</a> <a id="4004" href="Evaluator.Program.html#3965" class="Datatype">EvalMode</a>

<a id="4014" class="Symbol">{-#</a> <a id="4018" class="Keyword">COMPILE</a> <a id="4026" class="Keyword">GHC</a> <a id="4030" href="Evaluator.Program.html#3965" class="Datatype">EvalMode</a> <a id="4039" class="Pragma">=</a> <a id="4041" class="Pragma">data</a> <a id="4046" class="Pragma">EvalMode</a> <a id="4055" class="Pragma">(U</a> <a id="4058" class="Pragma">|</a> <a id="4060" class="Pragma">TL</a> <a id="4063" class="Pragma">|</a> <a id="4065" class="Pragma">TCK</a> <a id="4069" class="Pragma">|</a> <a id="4071" class="Pragma">TCEK)</a> <a id="4077" class="Symbol">#-}</a>

<a id="parsePLC"></a><a id="4082" href="Evaluator.Program.html#4082" class="Function">parsePLC</a> <a id="4091" class="Symbol">:</a> <a id="4093" href="Evaluator.Program.html#2261" class="Postulate">ProgramN</a> <a id="4102" class="Symbol">→</a> <a id="4104" href="Utils.html#1125" class="Datatype">Either</a> <a id="4111" href="Evaluator.Base.html#1239" class="Datatype">ERROR</a> <a id="4117" class="Symbol">(</a><a id="4118" href="Scoped.html#6896" class="Datatype">ScopedTm</a> <a id="4127" href="Scoped.html#1439" class="InductiveConstructor">Z</a><a id="4128" class="Symbol">)</a>
<a id="4130" href="Evaluator.Program.html#4082" class="Function">parsePLC</a> <a id="4139" href="Evaluator.Program.html#4139" class="Bound">namedprog</a> <a id="4149" class="Symbol">=</a> <a id="4151" class="Keyword">do</a>
  <a id="4156" href="Evaluator.Program.html#4156" class="Bound">prog</a> <a id="4161" href="Utils.html#2937" class="Field Operator">←</a> <a id="4163" href="Utils.html#3696" class="Function">withE</a> <a id="4169" class="Symbol">(</a><a id="4170" href="Evaluator.Base.html#1322" class="InductiveConstructor">ERROR.scopeError</a> <a id="4187" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4189" href="Scoped.html#7873" class="InductiveConstructor">freeVariableError</a><a id="4206" class="Symbol">)</a> <a id="4208" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="4210" href="Evaluator.Program.html#2320" class="Postulate">deBruijnify</a> <a id="4222" href="Evaluator.Program.html#4139" class="Bound">namedprog</a>
  <a id="4234" href="Utils.html#3696" class="Function">withE</a> <a id="4240" href="Evaluator.Base.html#1322" class="InductiveConstructor">scopeError</a> <a id="4251" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="4253" href="Scoped.html#9725" class="Function">scopeCheckTm</a> <a id="4266" class="Symbol">{</a><a id="4267" class="Number">0</a><a id="4268" class="Symbol">}{</a><a id="4270" href="Scoped.html#1439" class="InductiveConstructor">Z</a><a id="4271" class="Symbol">}</a> <a id="4273" class="Symbol">(</a><a id="4274" href="Scoped.html#4359" class="Function">shifter</a> <a id="4282" href="Scoped.html#1439" class="InductiveConstructor">Z</a> <a id="4284" class="Symbol">(</a><a id="4285" href="Evaluator.Program.html#2294" class="Postulate">convP</a> <a id="4291" href="Evaluator.Program.html#4156" class="Bound">prog</a><a id="4295" class="Symbol">))</a>
  <a id="4300" class="Comment">-- ^ FIXME: this should have an interface that guarantees that the</a>
  <a id="4369" class="Comment">-- shifter is run</a>

<a id="parseUPLC"></a><a id="4388" href="Evaluator.Program.html#4388" class="Function">parseUPLC</a> <a id="4398" class="Symbol">:</a> <a id="4400" href="Evaluator.Program.html#2381" class="Postulate">ProgramNU</a> <a id="4410" class="Symbol">→</a> <a id="4412" href="Utils.html#1125" class="Datatype">Either</a> <a id="4419" href="Evaluator.Base.html#1239" class="Datatype">ERROR</a> <a id="4425" class="Symbol">(</a><a id="4426" href="Data.Empty.html#914" class="Function">⊥</a> <a id="4428" href="Untyped.html#1671" class="Datatype Operator">U.⊢</a><a id="4431" class="Symbol">)</a>
<a id="4433" href="Evaluator.Program.html#4388" class="Function">parseUPLC</a> <a id="4443" href="Evaluator.Program.html#4443" class="Bound">namedprog</a> <a id="4453" class="Symbol">=</a> <a id="4455" class="Keyword">do</a>
  <a id="4460" href="Evaluator.Program.html#4460" class="Bound">prog</a> <a id="4465" href="Utils.html#2937" class="Field Operator">←</a> <a id="4467" href="Utils.html#3696" class="Function">withE</a> <a id="4473" class="Symbol">(</a><a id="4474" href="Evaluator.Base.html#1322" class="InductiveConstructor">ERROR.scopeError</a> <a id="4491" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4493" href="Scoped.html#7873" class="InductiveConstructor">freeVariableError</a><a id="4510" class="Symbol">)</a> <a id="4512" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="4514" href="Evaluator.Program.html#2416" class="Postulate">deBruijnifyU</a> <a id="4527" href="Evaluator.Program.html#4443" class="Bound">namedprog</a>
  <a id="4539" href="Utils.html#3696" class="Function">withE</a> <a id="4545" href="Evaluator.Base.html#1322" class="InductiveConstructor">scopeError</a> <a id="4556" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="4558" href="Untyped.html#6195" class="Function">U.scopeCheckU0</a> <a id="4573" class="Symbol">(</a><a id="4574" href="Evaluator.Program.html#2479" class="Postulate">convPU</a> <a id="4581" href="Evaluator.Program.html#4460" class="Bound">prog</a><a id="4585" class="Symbol">)</a>

<a id="typeCheckPLC"></a><a id="4588" href="Evaluator.Program.html#4588" class="Function">typeCheckPLC</a> <a id="4601" class="Symbol">:</a> <a id="4603" href="Scoped.html#6896" class="Datatype">ScopedTm</a> <a id="4612" href="Scoped.html#1439" class="InductiveConstructor">Z</a> <a id="4614" class="Symbol">→</a> <a id="4616" href="Utils.html#1125" class="Datatype">Either</a> <a id="4623" href="Check.html#2131" class="Datatype">TypeError</a> <a id="4633" class="Symbol">(</a><a id="4634" href="Agda.Builtin.Sigma.html#165" class="Record">Σ</a> <a id="4636" class="Symbol">(</a><a id="4637" class="InductiveConstructor">∅</a> <a id="4639" href="Type.BetaNormal.html#1044" class="Datatype Operator">⊢Nf⋆</a> <a id="4644" href="Utils.html#7316" class="InductiveConstructor">*</a><a id="4645" class="Symbol">)</a> <a id="4647" class="Symbol">(</a><a id="4648" class="InductiveConstructor">∅</a> <a id="4650" href="Algorithmic.html#5277" class="Datatype Operator">⊢_</a><a id="4652" class="Symbol">))</a>
<a id="4655" href="Evaluator.Program.html#4588" class="Function">typeCheckPLC</a> <a id="4668" href="Evaluator.Program.html#4668" class="Bound">t</a> <a id="4670" class="Symbol">=</a> <a id="4672" href="Check.html#17755" class="Function">inferType</a> <a id="4682" class="Symbol">_</a> <a id="4684" href="Evaluator.Program.html#4668" class="Bound">t</a>
</pre>
<p>Check if the term is an error term, and in that case return an ERROR.</p>

<p>This is used when evaluation of the reduction semantics has ended</p>

<pre class="Agda"><a id="checkError"></a><a id="4833" href="Evaluator.Program.html#4833" class="Function">checkError</a> <a id="4844" class="Symbol">:</a> <a id="4846" class="Symbol">∀{</a><a id="4848" href="Evaluator.Program.html#4848" class="Bound">A</a><a id="4849" class="Symbol">}</a> <a id="4851" class="Symbol">→</a> <a id="4853" class="InductiveConstructor">∅</a> <a id="4855" href="Algorithmic.html#5277" class="Datatype Operator">⊢</a> <a id="4857" href="Evaluator.Program.html#4848" class="Bound">A</a> <a id="4859" class="Symbol">→</a> <a id="4861" href="Utils.html#1125" class="Datatype">Either</a> <a id="4868" href="Evaluator.Base.html#1239" class="Datatype">ERROR</a> <a id="4874" class="Symbol">(</a><a id="4875" class="InductiveConstructor">∅</a> <a id="4877" href="Algorithmic.html#5277" class="Datatype Operator">⊢</a> <a id="4879" href="Evaluator.Program.html#4848" class="Bound">A</a> <a id="4881" class="Symbol">)</a>
<a id="4883" href="Evaluator.Program.html#4833" class="Function">checkError</a> <a id="4894" class="Symbol">(</a><a id="4895" href="Algorithmic.html#7621" class="InductiveConstructor">error</a> <a id="4901" class="Symbol">_)</a> <a id="4904" class="Symbol">=</a> <a id="4906" href="Utils.html#1158" class="InductiveConstructor">inj₁</a> <a id="4911" class="Symbol">(</a><a id="4912" href="Evaluator.Base.html#1356" class="InductiveConstructor">runtimeError</a> <a id="4925" href="Utils.html#4408" class="InductiveConstructor">userError</a><a id="4934" class="Symbol">)</a>
<a id="4936" href="Evaluator.Program.html#4833" class="CatchallClause Function">checkError</a><a id="4946" class="CatchallClause"> </a><a id="4947" href="Evaluator.Program.html#4947" class="CatchallClause Bound">t</a>         <a id="4957" class="Symbol">=</a> <a id="4959" href="Utils.html#2909" class="Field">return</a> <a id="4966" href="Evaluator.Program.html#4947" class="Bound">t</a>

<a id="executePLC"></a><a id="4969" href="Evaluator.Program.html#4969" class="Function">executePLC</a> <a id="4980" class="Symbol">:</a> <a id="4982" href="Evaluator.Program.html#3965" class="Datatype">EvalMode</a> <a id="4991" class="Symbol">→</a> <a id="4993" href="Scoped.html#6896" class="Datatype">ScopedTm</a> <a id="5002" href="Scoped.html#1439" class="InductiveConstructor">Z</a> <a id="5004" class="Symbol">→</a> <a id="5006" href="Utils.html#1125" class="Datatype">Either</a> <a id="5013" href="Evaluator.Base.html#1239" class="Datatype">ERROR</a> <a id="5019" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="5026" href="Evaluator.Program.html#4969" class="Function">executePLC</a> <a id="5037" href="Evaluator.Program.html#3988" class="InductiveConstructor">U</a> <a id="5039" href="Evaluator.Program.html#5039" class="Bound">t</a> <a id="5041" class="Symbol">=</a> <a id="5043" class="Keyword">do</a>
  <a id="5048" class="Symbol">(</a><a id="5049" href="Evaluator.Program.html#5049" class="Bound">A</a> <a id="5051" href="Evaluator.Program.html#293" class="InductiveConstructor Operator">,,</a> <a id="5054" href="Evaluator.Program.html#5054" class="Bound">t</a><a id="5055" class="Symbol">)</a> <a id="5057" href="Utils.html#2937" class="Field Operator">←</a> <a id="5059" href="Utils.html#3696" class="Function">withE</a> <a id="5065" class="Symbol">(λ</a> <a id="5068" href="Evaluator.Program.html#5068" class="Bound">e</a> <a id="5070" class="Symbol">→</a> <a id="5072" href="Evaluator.Base.html#1259" class="InductiveConstructor">typeError</a> <a id="5082" class="Symbol">(</a><a id="5083" href="Evaluator.Base.html#1460" class="Function">uglyTypeError</a> <a id="5097" href="Evaluator.Program.html#5068" class="Bound">e</a><a id="5098" class="Symbol">))</a> <a id="5101" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="5103" href="Evaluator.Program.html#4588" class="Function">typeCheckPLC</a> <a id="5116" href="Evaluator.Program.html#5039" class="Bound">t</a>
  <a id="5120" href="Untyped.CEK.html#3732" class="InductiveConstructor">□</a> <a id="5122" href="Evaluator.Program.html#5122" class="Bound">V</a> <a id="5124" href="Utils.html#2937" class="Field Operator">←</a> <a id="5126" href="Utils.html#3696" class="Function">withE</a> <a id="5132" href="Evaluator.Base.html#1356" class="InductiveConstructor">runtimeError</a> <a id="5145" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="5147" href="Untyped.CEK.html#23742" class="Function">U.stepper</a> <a id="5157" href="Evaluator.Base.html#3060" class="Function">maxsteps</a> <a id="5166" class="Symbol">(</a><a id="5167" href="Untyped.CEK.html#1286" class="InductiveConstructor">ε</a> <a id="5169" href="Untyped.CEK.html#3638" class="InductiveConstructor Operator">;</a> <a id="5171" href="Untyped.CEK.html#1383" class="InductiveConstructor">[]</a> <a id="5174" href="Untyped.CEK.html#3638" class="InductiveConstructor Operator">▻</a> <a id="5176" href="Algorithmic.Erasure.html#2235" class="Function">erase</a> <a id="5182" href="Evaluator.Program.html#5054" class="Bound">t</a><a id="5183" class="Symbol">)</a>
    <a id="5189" class="Keyword">where</a> <a id="5195" href="Untyped.CEK.html#3752" class="InductiveConstructor">◆</a>  <a id="5198" class="Symbol">→</a> <a id="5200" href="Utils.html#1158" class="InductiveConstructor">inj₁</a> <a id="5205" class="Symbol">(</a><a id="5206" href="Evaluator.Base.html#1356" class="InductiveConstructor">runtimeError</a> <a id="5219" href="Utils.html#4408" class="InductiveConstructor">userError</a><a id="5228" class="Symbol">)</a>
          <a id="5240" class="CatchallClause Symbol">_</a>  <a id="5243" class="Symbol">→</a> <a id="5245" href="Utils.html#1158" class="InductiveConstructor">inj₁</a> <a id="5250" class="Symbol">(</a><a id="5251" href="Evaluator.Base.html#1356" class="InductiveConstructor">runtimeError</a> <a id="5264" href="Utils.html#4382" class="InductiveConstructor">gasError</a><a id="5272" class="Symbol">)</a>
<a id="5274" class="Comment">{-
just t&#39; ← withE runtimeError $ U.stepper maxsteps (ε ; [] ▻ erase t)
    where nothing → inj₁ (runtimeError userError)
    -}</a>
  <a id="5405" href="Utils.html#2909" class="Field">return</a> <a id="5412" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="5414" href="Evaluator.Base.html#799" class="Postulate">prettyPrintUTm</a> <a id="5429" class="Symbol">(</a><a id="5430" href="Untyped.html#4888" class="Function">U.extricateU0</a> <a id="5444" class="Symbol">(</a><a id="5445" href="Untyped.CEK.html#2525" class="Function">U.discharge</a> <a id="5457" href="Evaluator.Program.html#5122" class="Bound">V</a><a id="5458" class="Symbol">))</a>
<a id="5461" href="Evaluator.Program.html#4969" class="Function">executePLC</a> <a id="5472" href="Evaluator.Program.html#3990" class="InductiveConstructor">TL</a> <a id="5475" href="Evaluator.Program.html#5475" class="Bound">t</a> <a id="5477" class="Symbol">=</a> <a id="5479" class="Keyword">do</a>
  <a id="5484" class="Symbol">(</a><a id="5485" href="Evaluator.Program.html#5485" class="Bound">A</a> <a id="5487" href="Evaluator.Program.html#293" class="InductiveConstructor Operator">,,</a> <a id="5490" href="Evaluator.Program.html#5490" class="Bound">t</a><a id="5491" class="Symbol">)</a> <a id="5493" href="Utils.html#2937" class="Field Operator">←</a> <a id="5495" href="Utils.html#3696" class="Function">withE</a> <a id="5501" class="Symbol">(λ</a> <a id="5504" href="Evaluator.Program.html#5504" class="Bound">e</a> <a id="5506" class="Symbol">→</a> <a id="5508" href="Evaluator.Base.html#1259" class="InductiveConstructor">typeError</a> <a id="5518" class="Symbol">(</a><a id="5519" href="Evaluator.Base.html#1460" class="Function">uglyTypeError</a> <a id="5533" href="Evaluator.Program.html#5504" class="Bound">e</a><a id="5534" class="Symbol">))</a> <a id="5537" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="5539" href="Evaluator.Program.html#4588" class="Function">typeCheckPLC</a> <a id="5552" href="Evaluator.Program.html#5475" class="Bound">t</a>
  <a id="5556" href="Evaluator.Program.html#5556" class="Bound">t&#39;</a> <a id="5559" href="Utils.html#2937" class="Field Operator">←</a> <a id="5561" class="Symbol">(</a><a id="5562" href="Utils.html#3696" class="Function">withE</a> <a id="5568" href="Evaluator.Base.html#1356" class="InductiveConstructor">runtimeError</a> <a id="5581" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="5583" href="Algorithmic.Evaluation.html#2112" class="Function">L.stepper</a> <a id="5593" href="Evaluator.Program.html#5490" class="Bound">t</a> <a id="5595" href="Evaluator.Base.html#3060" class="Function">maxsteps</a><a id="5603" class="Symbol">)</a> <a id="5605" href="Utils.html#2937" class="Field Operator">&gt;&gt;=</a> <a id="5609" href="Evaluator.Program.html#4833" class="Function">checkError</a>
  <a id="5622" href="Utils.html#2909" class="Field">return</a> <a id="5629" class="Symbol">(</a><a id="5630" href="Evaluator.Base.html#732" class="Postulate">prettyPrintTm</a> <a id="5644" class="Symbol">(</a><a id="5645" href="Scoped.html#6018" class="Function">unshifter</a> <a id="5655" href="Scoped.html#1439" class="InductiveConstructor">Z</a> <a id="5657" class="Symbol">(</a><a id="5658" href="Scoped.html#11939" class="Function">extricateScope</a> <a id="5673" class="Symbol">(</a><a id="5674" href="Scoped.Extrication.html#3031" class="Function">extricate</a> <a id="5684" href="Evaluator.Program.html#5556" class="Bound">t&#39;</a><a id="5686" class="Symbol">))))</a>
<a id="5691" href="Evaluator.Program.html#4969" class="Function">executePLC</a> <a id="5702" href="Evaluator.Program.html#3993" class="InductiveConstructor">TCK</a> <a id="5706" href="Evaluator.Program.html#5706" class="Bound">t</a> <a id="5708" class="Symbol">=</a> <a id="5710" class="Keyword">do</a>
  <a id="5715" class="Symbol">(</a><a id="5716" href="Evaluator.Program.html#5716" class="Bound">A</a> <a id="5718" href="Evaluator.Program.html#293" class="InductiveConstructor Operator">,,</a> <a id="5721" href="Evaluator.Program.html#5721" class="Bound">t</a><a id="5722" class="Symbol">)</a> <a id="5724" href="Utils.html#2937" class="Field Operator">←</a> <a id="5726" href="Utils.html#3696" class="Function">withE</a> <a id="5732" class="Symbol">(λ</a> <a id="5735" href="Evaluator.Program.html#5735" class="Bound">e</a> <a id="5737" class="Symbol">→</a> <a id="5739" href="Evaluator.Base.html#1259" class="InductiveConstructor">typeError</a> <a id="5749" class="Symbol">(</a><a id="5750" href="Evaluator.Base.html#1460" class="Function">uglyTypeError</a> <a id="5764" href="Evaluator.Program.html#5735" class="Bound">e</a><a id="5765" class="Symbol">))</a> <a id="5768" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="5770" href="Evaluator.Program.html#4588" class="Function">typeCheckPLC</a> <a id="5783" href="Evaluator.Program.html#5706" class="Bound">t</a>
  <a id="5787" href="Algorithmic.CK.html#1470" class="InductiveConstructor">□</a> <a id="5789" class="Symbol">{</a><a id="5790" class="Argument">t</a> <a id="5792" class="Symbol">=</a> <a id="5794" href="Evaluator.Program.html#5794" class="Bound">t</a><a id="5795" class="Symbol">}</a> <a id="5797" href="Evaluator.Program.html#5797" class="Bound">v</a> <a id="5799" href="Utils.html#2937" class="Field Operator">←</a> <a id="5801" href="Utils.html#3696" class="Function">withE</a> <a id="5807" href="Evaluator.Base.html#1356" class="InductiveConstructor">runtimeError</a> <a id="5820" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="5822" href="Algorithmic.CK.html#4610" class="Function">Algorithmic.CK.stepper</a> <a id="5845" href="Evaluator.Base.html#3060" class="Function">maxsteps</a> <a id="5854" class="Symbol">(</a><a id="5855" href="Algorithmic.CK.html#1177" class="InductiveConstructor">ε</a> <a id="5857" href="Algorithmic.CK.html#1348" class="InductiveConstructor Operator">▻</a> <a id="5859" href="Evaluator.Program.html#5721" class="Bound">t</a><a id="5860" class="Symbol">)</a>
    <a id="5866" class="Keyword">where</a> <a id="5872" href="Algorithmic.CK.html#1510" class="InductiveConstructor">◆</a> <a id="5874" class="Symbol">_</a>  <a id="5877" class="Symbol">→</a> <a id="5879" href="Utils.html#1158" class="InductiveConstructor">inj₁</a> <a id="5884" class="Symbol">(</a><a id="5885" href="Evaluator.Base.html#1356" class="InductiveConstructor">runtimeError</a> <a id="5898" href="Utils.html#4408" class="InductiveConstructor">userError</a><a id="5907" class="Symbol">)</a>
          <a id="5919" class="CatchallClause Symbol">_</a>    <a id="5924" class="Symbol">→</a> <a id="5926" href="Utils.html#1158" class="InductiveConstructor">inj₁</a> <a id="5931" class="Symbol">(</a><a id="5932" href="Evaluator.Base.html#1356" class="InductiveConstructor">runtimeError</a> <a id="5945" href="Utils.html#4382" class="InductiveConstructor">gasError</a><a id="5953" class="Symbol">)</a>
  <a id="5957" href="Utils.html#2909" class="Field">return</a> <a id="5964" class="Symbol">(</a><a id="5965" href="Evaluator.Base.html#732" class="Postulate">prettyPrintTm</a> <a id="5979" class="Symbol">(</a><a id="5980" href="Scoped.html#6018" class="Function">unshifter</a> <a id="5990" href="Scoped.html#1439" class="InductiveConstructor">Z</a> <a id="5992" class="Symbol">(</a><a id="5993" href="Scoped.html#11939" class="Function">extricateScope</a> <a id="6008" class="Symbol">(</a><a id="6009" href="Scoped.Extrication.html#3031" class="Function">extricate</a> <a id="6019" href="Evaluator.Program.html#5794" class="Bound">t</a><a id="6020" class="Symbol">))))</a>
<a id="6025" href="Evaluator.Program.html#4969" class="Function">executePLC</a> <a id="6036" href="Evaluator.Program.html#3997" class="InductiveConstructor">TCEK</a> <a id="6041" href="Evaluator.Program.html#6041" class="Bound">t</a> <a id="6043" class="Symbol">=</a> <a id="6045" class="Keyword">do</a>
  <a id="6050" class="Symbol">(</a><a id="6051" href="Evaluator.Program.html#6051" class="Bound">A</a> <a id="6053" href="Evaluator.Program.html#293" class="InductiveConstructor Operator">,,</a> <a id="6056" href="Evaluator.Program.html#6056" class="Bound">t</a><a id="6057" class="Symbol">)</a> <a id="6059" href="Utils.html#2937" class="Field Operator">←</a> <a id="6061" href="Utils.html#3696" class="Function">withE</a> <a id="6067" class="Symbol">(λ</a> <a id="6070" href="Evaluator.Program.html#6070" class="Bound">e</a> <a id="6072" class="Symbol">→</a> <a id="6074" href="Evaluator.Base.html#1259" class="InductiveConstructor">typeError</a> <a id="6084" class="Symbol">(</a><a id="6085" href="Evaluator.Base.html#1460" class="Function">uglyTypeError</a> <a id="6099" href="Evaluator.Program.html#6070" class="Bound">e</a><a id="6100" class="Symbol">))</a> <a id="6103" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="6105" href="Evaluator.Program.html#4588" class="Function">typeCheckPLC</a> <a id="6118" href="Evaluator.Program.html#6041" class="Bound">t</a>
  <a id="6122" href="Algorithmic.CEK.html#17687" class="InductiveConstructor">□</a> <a id="6124" href="Evaluator.Program.html#6124" class="Bound">V</a> <a id="6126" href="Utils.html#2937" class="Field Operator">←</a> <a id="6128" href="Utils.html#3696" class="Function">withE</a> <a id="6134" href="Evaluator.Base.html#1356" class="InductiveConstructor">runtimeError</a> <a id="6147" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="6149" href="Algorithmic.CEK.html#19925" class="Function">Algorithmic.CEK.stepper</a> <a id="6173" href="Evaluator.Base.html#3060" class="Function">maxsteps</a> <a id="6182" class="Symbol">(</a><a id="6183" href="Algorithmic.CEK.html#17451" class="InductiveConstructor">ε</a> <a id="6185" href="Algorithmic.CEK.html#17565" class="InductiveConstructor Operator">;</a> <a id="6187" href="Algorithmic.CEK.html#3836" class="InductiveConstructor">[]</a> <a id="6190" href="Algorithmic.CEK.html#17565" class="InductiveConstructor Operator">▻</a> <a id="6192" href="Evaluator.Program.html#6056" class="Bound">t</a><a id="6193" class="Symbol">)</a>
    <a id="6199" class="Keyword">where</a> <a id="6205" href="Algorithmic.CEK.html#17715" class="InductiveConstructor">◆</a> <a id="6207" class="Symbol">_</a>  <a id="6210" class="Symbol">→</a> <a id="6212" href="Utils.html#1158" class="InductiveConstructor">inj₁</a> <a id="6217" class="Symbol">(</a><a id="6218" href="Evaluator.Base.html#1356" class="InductiveConstructor">runtimeError</a> <a id="6231" href="Utils.html#4408" class="InductiveConstructor">userError</a><a id="6240" class="Symbol">)</a>
          <a id="6252" class="CatchallClause Symbol">_</a>    <a id="6257" class="Symbol">→</a> <a id="6259" href="Utils.html#1158" class="InductiveConstructor">inj₁</a> <a id="6264" class="Symbol">(</a><a id="6265" href="Evaluator.Base.html#1356" class="InductiveConstructor">runtimeError</a> <a id="6278" href="Utils.html#4382" class="InductiveConstructor">gasError</a><a id="6286" class="Symbol">)</a>
  <a id="6290" href="Utils.html#2909" class="Field">return</a> <a id="6297" class="Symbol">(</a><a id="6298" href="Evaluator.Base.html#732" class="Postulate">prettyPrintTm</a> <a id="6312" class="Symbol">(</a><a id="6313" href="Scoped.html#6018" class="Function">unshifter</a> <a id="6323" href="Scoped.html#1439" class="InductiveConstructor">Z</a> <a id="6325" class="Symbol">(</a><a id="6326" href="Scoped.html#11939" class="Function">extricateScope</a> <a id="6341" class="Symbol">(</a><a id="6342" href="Scoped.Extrication.html#3031" class="Function">extricate</a> <a id="6352" class="Symbol">(</a><a id="6353" href="Algorithmic.CEK.html#4039" class="Function">Algorithmic.CEK.discharge</a> <a id="6379" href="Evaluator.Program.html#6124" class="Bound">V</a><a id="6380" class="Symbol">)))))</a>

<a id="showUPLCResult"></a><a id="6387" href="Evaluator.Program.html#6387" class="Function">showUPLCResult</a> <a id="6402" class="Symbol">:</a> <a id="6404" href="Untyped.CEK.html#3618" class="Datatype">U.State</a> <a id="6412" class="Symbol">→</a> <a id="6414" href="Utils.html#1125" class="Datatype">Either</a> <a id="6421" href="Evaluator.Base.html#1239" class="Datatype">ERROR</a> <a id="6427" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="6434" href="Evaluator.Program.html#6387" class="Function">showUPLCResult</a> <a id="6449" class="Symbol">(</a><a id="6450" href="Untyped.CEK.html#3732" class="InductiveConstructor">□</a> <a id="6452" href="Evaluator.Program.html#6452" class="Bound">V</a><a id="6453" class="Symbol">)</a> <a id="6455" class="Symbol">=</a> <a id="6457" href="Utils.html#2909" class="Field">return</a> <a id="6464" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="6466" href="Evaluator.Base.html#799" class="Postulate">prettyPrintUTm</a> <a id="6481" class="Symbol">(</a><a id="6482" href="Untyped.html#4888" class="Function">U.extricateU0</a> <a id="6496" class="Symbol">(</a><a id="6497" href="Untyped.CEK.html#2525" class="Function">U.discharge</a> <a id="6509" href="Evaluator.Program.html#6452" class="Bound">V</a><a id="6510" class="Symbol">))</a>
<a id="6513" href="Evaluator.Program.html#6387" class="Function">showUPLCResult</a> <a id="6528" href="Untyped.CEK.html#3752" class="InductiveConstructor">◆</a>     <a id="6534" class="Symbol">=</a> <a id="6536" href="Utils.html#1158" class="InductiveConstructor">inj₁</a> <a id="6541" class="Symbol">(</a><a id="6542" href="Evaluator.Base.html#1356" class="InductiveConstructor">runtimeError</a> <a id="6555" href="Utils.html#4408" class="InductiveConstructor">userError</a><a id="6564" class="Symbol">)</a>
<a id="6566" href="Evaluator.Program.html#6387" class="CatchallClause Function">showUPLCResult</a><a id="6580" class="CatchallClause"> </a><a id="6581" class="CatchallClause Symbol">_</a>     <a id="6587" class="Symbol">=</a> <a id="6589" href="Utils.html#1158" class="InductiveConstructor">inj₁</a> <a id="6594" class="Symbol">(</a><a id="6595" href="Evaluator.Base.html#1356" class="InductiveConstructor">runtimeError</a> <a id="6608" href="Utils.html#4382" class="InductiveConstructor">gasError</a><a id="6616" class="Symbol">)</a>

<a id="executeUPLCwithMP"></a><a id="6619" href="Evaluator.Program.html#6619" class="Function">executeUPLCwithMP</a> <a id="6637" class="Symbol">:</a> <a id="6639" class="Symbol">∀{</a><a id="6641" href="Evaluator.Program.html#6641" class="Bound">A</a><a id="6642" class="Symbol">}</a> <a id="6644" class="Symbol">→</a> <a id="6646" href="Cost.Raw.html#5784" class="Function">RawCostModel</a> <a id="6659" class="Symbol">→</a> <a id="6661" class="Symbol">(</a><a id="6662" href="Cost.html#3595" class="Function">CostModel</a> <a id="6672" class="Symbol">→</a> <a id="6674" href="Cost.Base.html#2053" class="Record">MachineParameters</a> <a id="6692" href="Evaluator.Program.html#6641" class="Bound">A</a><a id="6693" class="Symbol">)</a> <a id="6695" class="Symbol">→</a> <a id="6697" class="Symbol">(</a><a id="6698" href="Evaluator.Program.html#6641" class="Bound">A</a> <a id="6700" class="Symbol">→</a> <a id="6702" href="Agda.Builtin.String.html#335" class="Postulate">String</a><a id="6708" class="Symbol">)</a> <a id="6710" class="Symbol">→</a> <a id="6712" href="Data.Empty.html#914" class="Function">⊥</a> <a id="6714" href="Untyped.html#1671" class="Datatype Operator">U.⊢</a> <a id="6718" class="Symbol">→</a> <a id="6720" href="Utils.html#1125" class="Datatype">Either</a> <a id="6727" href="Evaluator.Base.html#1239" class="Datatype">ERROR</a> <a id="6733" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="6740" href="Evaluator.Program.html#6619" class="Function">executeUPLCwithMP</a> <a id="6758" class="Symbol">(</a><a id="6759" href="Evaluator.Program.html#6759" class="Bound">cekMachineCosts</a> <a id="6775" href="Utils.html#4878" class="InductiveConstructor Operator">,</a> <a id="6777" href="Evaluator.Program.html#6777" class="Bound">rawmodel</a><a id="6785" class="Symbol">)</a> <a id="6787" href="Evaluator.Program.html#6787" class="Bound">mkMP</a> <a id="6792" href="Evaluator.Program.html#6792" class="Bound">report</a> <a id="6799" href="Evaluator.Program.html#6799" class="Bound">t</a> <a id="6801" class="Keyword">with</a> <a id="6806" href="Cost.Model.html#9634" class="Function">createMap</a> <a id="6816" href="Evaluator.Program.html#6777" class="Bound">rawmodel</a>
<a id="6825" class="Symbol">...</a> <a id="6829" class="Symbol">|</a> <a id="6831" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6836" href="Evaluator.Program.html#6836" class="Bound">model</a> <a id="6842" class="Symbol">=</a> <a id="6844" class="Keyword">do</a>
    <a id="6851" class="Keyword">let</a> <a id="6855" href="Evaluator.Program.html#6855" class="Bound">machineparam</a> <a id="6868" class="Symbol">=</a> <a id="6870" class="Bound">mkMP</a> <a id="6875" class="Symbol">(</a><a id="6876" class="Bound">cekMachineCosts</a> <a id="6892" href="Utils.html#4878" class="InductiveConstructor Operator">,</a> <a id="6894" href="Evaluator.Program.html#6836" class="Bound">model</a><a id="6899" class="Symbol">)</a>
    <a id="6905" class="Keyword">let</a> <a id="6909" class="Symbol">(</a><a id="6910" href="Evaluator.Program.html#6910" class="Bound">ev</a> <a id="6913" href="Utils.html#4001" class="InductiveConstructor Operator">,</a> <a id="6915" href="Evaluator.Program.html#6915" class="Bound">exBudget</a><a id="6923" class="Symbol">)</a> <a id="6925" class="Symbol">=</a> <a id="6927" href="Untyped.CEKWithCost.html#6609" class="Function">U.stepperC</a> <a id="6938" href="Evaluator.Program.html#6855" class="Bound">machineparam</a> <a id="6951" href="Evaluator.Base.html#3060" class="Function">maxsteps</a> <a id="6960" class="Symbol">(</a><a id="6961" href="Untyped.CEK.html#1286" class="InductiveConstructor">ε</a> <a id="6963" href="Untyped.CEK.html#3638" class="InductiveConstructor Operator">;</a> <a id="6965" href="Untyped.CEK.html#1383" class="InductiveConstructor">[]</a> <a id="6968" href="Untyped.CEK.html#3638" class="InductiveConstructor Operator">▻</a> <a id="6970" class="Bound">t</a><a id="6971" class="Symbol">)</a>
    <a id="6977" href="Evaluator.Program.html#6977" class="Bound">x</a> <a id="6979" href="Utils.html#2937" class="Field Operator">←</a> <a id="6981" href="Utils.html#3696" class="Function">withE</a> <a id="6987" href="Evaluator.Base.html#1356" class="InductiveConstructor">runtimeError</a> <a id="7000" href="Evaluator.Program.html#6910" class="Bound">ev</a>
    <a id="7007" href="Evaluator.Program.html#7007" class="Bound">r</a> <a id="7009" href="Utils.html#2937" class="Field Operator">←</a> <a id="7011" href="Evaluator.Program.html#6387" class="Function">showUPLCResult</a> <a id="7026" href="Evaluator.Program.html#6977" class="Bound">x</a>
    <a id="7032" href="Utils.html#2909" class="Field">return</a> <a id="7039" class="Symbol">(</a><a id="7040" href="Evaluator.Program.html#7007" class="Bound">r</a> <a id="7042" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7045" class="Bound">report</a> <a id="7052" href="Evaluator.Program.html#6915" class="Bound">exBudget</a><a id="7060" class="Symbol">)</a>
<a id="7062" class="Symbol">...</a> <a id="7066" class="Symbol">|</a> <a id="7068" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7076" class="Symbol">=</a> <a id="7078" href="Utils.html#1158" class="InductiveConstructor">inj₁</a> <a id="7083" class="Symbol">(</a><a id="7084" href="Evaluator.Base.html#1394" class="InductiveConstructor">jsonError</a> <a id="7094" class="String">&quot;while processing parameters.&quot;</a><a id="7124" class="Symbol">)</a>

<a id="executeUPLC"></a><a id="7127" href="Evaluator.Program.html#7127" class="Function">executeUPLC</a> <a id="7139" class="Symbol">:</a> <a id="7141" href="Evaluator.Program.html#3759" class="Datatype">BudgetMode</a> <a id="7152" href="Cost.Raw.html#5784" class="Function">RawCostModel</a> <a id="7165" class="Symbol">→</a> <a id="7167" href="Data.Empty.html#914" class="Function">⊥</a> <a id="7169" href="Untyped.html#1671" class="Datatype Operator">U.⊢</a> <a id="7173" class="Symbol">→</a> <a id="7175" href="Utils.html#1125" class="Datatype">Either</a> <a id="7182" href="Evaluator.Base.html#1239" class="Datatype">ERROR</a> <a id="7188" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="7195" href="Evaluator.Program.html#7127" class="Function">executeUPLC</a> <a id="7207" href="Evaluator.Program.html#3794" class="InductiveConstructor">Silent</a> <a id="7214" href="Evaluator.Program.html#7214" class="Bound">t</a> <a id="7216" class="Symbol">=</a> <a id="7218" class="Symbol">(</a><a id="7219" href="Utils.html#3696" class="Function">withE</a> <a id="7225" href="Evaluator.Base.html#1356" class="InductiveConstructor">runtimeError</a> <a id="7238" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="7240" href="Untyped.CEK.html#23742" class="Function">U.stepper</a> <a id="7250" href="Evaluator.Base.html#3060" class="Function">maxsteps</a> <a id="7259" class="Symbol">(</a><a id="7260" href="Untyped.CEK.html#1286" class="InductiveConstructor">ε</a> <a id="7262" href="Untyped.CEK.html#3638" class="InductiveConstructor Operator">;</a> <a id="7264" href="Untyped.CEK.html#1383" class="InductiveConstructor">[]</a> <a id="7267" href="Untyped.CEK.html#3638" class="InductiveConstructor Operator">▻</a> <a id="7269" href="Evaluator.Program.html#7214" class="Bound">t</a><a id="7270" class="Symbol">))</a> <a id="7273" href="Utils.html#2937" class="Field Operator">&gt;&gt;=</a> <a id="7277" href="Evaluator.Program.html#6387" class="Function">showUPLCResult</a>
<a id="7292" href="Evaluator.Program.html#7127" class="Function">executeUPLC</a> <a id="7304" class="Symbol">(</a><a id="7305" href="Evaluator.Program.html#3820" class="InductiveConstructor">Counting</a> <a id="7314" href="Evaluator.Program.html#7314" class="Bound">rcm</a><a id="7317" class="Symbol">)</a> <a id="7319" href="Evaluator.Program.html#7319" class="Bound">t</a> <a id="7321" class="Symbol">=</a> <a id="7323" href="Evaluator.Program.html#6619" class="Function">executeUPLCwithMP</a> <a id="7341" href="Evaluator.Program.html#7314" class="Bound">rcm</a> <a id="7345" href="Cost.html#4635" class="Function">machineParameters</a> <a id="7363" href="Cost.html#4849" class="Function">countingReport</a> <a id="7378" href="Evaluator.Program.html#7319" class="Bound">t</a>
<a id="7380" href="Evaluator.Program.html#7127" class="Function">executeUPLC</a> <a id="7392" class="Symbol">(</a><a id="7393" href="Evaluator.Program.html#3850" class="InductiveConstructor">Tallying</a> <a id="7402" href="Evaluator.Program.html#7402" class="Bound">rcm</a><a id="7405" class="Symbol">)</a> <a id="7407" href="Evaluator.Program.html#7407" class="Bound">t</a> <a id="7409" class="Symbol">=</a> <a id="7411" href="Evaluator.Program.html#6619" class="Function">executeUPLCwithMP</a> <a id="7429" href="Evaluator.Program.html#7402" class="Bound">rcm</a> <a id="7433" href="Cost.html#6828" class="Function">tallyingMachineParameters</a> <a id="7459" href="Cost.html#7079" class="Function">tallyingReport</a> <a id="7474" href="Evaluator.Program.html#7407" class="Bound">t</a>

<a id="evalProgramNU"></a><a id="7477" href="Evaluator.Program.html#7477" class="Function">evalProgramNU</a> <a id="7491" class="Symbol">:</a> <a id="7493" href="Evaluator.Program.html#3759" class="Datatype">BudgetMode</a> <a id="7504" href="Cost.Raw.html#5784" class="Function">RawCostModel</a> <a id="7517" class="Symbol">→</a> <a id="7519" href="Evaluator.Program.html#2381" class="Postulate">ProgramNU</a> <a id="7529" class="Symbol">→</a> <a id="7531" href="Utils.html#1125" class="Datatype">Either</a> <a id="7538" href="Evaluator.Base.html#1239" class="Datatype">ERROR</a> <a id="7544" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="7551" href="Evaluator.Program.html#7477" class="Function">evalProgramNU</a> <a id="7565" href="Evaluator.Program.html#7565" class="Bound">bm</a> <a id="7568" href="Evaluator.Program.html#7568" class="Bound">namedprog</a> <a id="7578" class="Symbol">=</a> <a id="7580" class="Keyword">do</a>
  <a id="7585" href="Evaluator.Program.html#7585" class="Bound">t</a> <a id="7587" href="Utils.html#2937" class="Field Operator">←</a> <a id="7589" href="Evaluator.Program.html#4388" class="Function">parseUPLC</a> <a id="7599" href="Evaluator.Program.html#7568" class="Bound">namedprog</a>
  <a id="7611" href="Evaluator.Program.html#7127" class="Function">executeUPLC</a> <a id="7623" href="Evaluator.Program.html#7565" class="Bound">bm</a> <a id="7626" href="Evaluator.Program.html#7585" class="Bound">t</a>

<a id="evalProgramN"></a><a id="7629" href="Evaluator.Program.html#7629" class="Function">evalProgramN</a> <a id="7642" class="Symbol">:</a> <a id="7644" href="Evaluator.Program.html#3965" class="Datatype">EvalMode</a> <a id="7653" class="Symbol">→</a> <a id="7655" href="Evaluator.Program.html#2261" class="Postulate">ProgramN</a> <a id="7664" class="Symbol">→</a> <a id="7666" href="Utils.html#1125" class="Datatype">Either</a> <a id="7673" href="Evaluator.Base.html#1239" class="Datatype">ERROR</a> <a id="7679" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="7686" href="Evaluator.Program.html#7629" class="Function">evalProgramN</a> <a id="7699" href="Evaluator.Program.html#7699" class="Bound">m</a> <a id="7701" href="Evaluator.Program.html#7701" class="Bound">namedprog</a> <a id="7711" class="Symbol">=</a> <a id="7713" class="Keyword">do</a>
  <a id="7718" class="Comment">{-
  -- some debugging code
  prog ← withE (ERROR.scopeError ∘ freeVariableError) $ deBruijnify namedprog
  let shiftedprog = shifter Z (convP prog)
  scopedprog ← withE scopeError $ scopeCheckTm {0}{Z} shiftedprog
  let extricatedprog = extricateScope scopedprog
  let unshiftedprog = unshifter Z extricatedprog
  return (&quot;orginal: &quot; ++ rawPrinter (convP prog) ++ &quot;\n&quot; ++
          &quot;shifted: &quot; ++ rawPrinter shiftedprog ++ &quot;\n&quot; ++
          &quot;instrinsically scoped: &quot; ++ Scoped.ugly scopedprog ++ &quot;\n&quot; ++
          &quot;extricated: &quot; ++ rawPrinter extricatedprog ++ &quot;\n&quot; ++
          &quot;unshifted: &quot; ++ rawPrinter unshiftedprog ++ &quot;\n&quot; ++
          &quot;unconved: &quot; ++ prettyPrintTm unshiftedprog ++ &quot;\n&quot;)
   -}</a>
   <a id="8423" href="Evaluator.Program.html#8423" class="Bound">t</a> <a id="8425" href="Utils.html#2937" class="Field Operator">←</a> <a id="8427" href="Evaluator.Program.html#4082" class="Function">parsePLC</a> <a id="8436" href="Evaluator.Program.html#7701" class="Bound">namedprog</a>
   <a id="8449" href="Evaluator.Program.html#4969" class="Function">executePLC</a> <a id="8460" href="Evaluator.Program.html#7699" class="Bound">m</a> <a id="8462" href="Evaluator.Program.html#8423" class="Bound">t</a>

<a id="typeCheckProgramN"></a><a id="8465" href="Evaluator.Program.html#8465" class="Function">typeCheckProgramN</a> <a id="8483" class="Symbol">:</a> <a id="8485" href="Evaluator.Program.html#2261" class="Postulate">ProgramN</a> <a id="8494" class="Symbol">→</a> <a id="8496" href="Utils.html#1125" class="Datatype">Either</a> <a id="8503" href="Evaluator.Base.html#1239" class="Datatype">ERROR</a> <a id="8509" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="8516" href="Evaluator.Program.html#8465" class="Function">typeCheckProgramN</a> <a id="8534" href="Evaluator.Program.html#8534" class="Bound">namedprog</a> <a id="8544" class="Symbol">=</a> <a id="8546" class="Keyword">do</a>
  <a id="8551" href="Evaluator.Program.html#8551" class="Bound">t</a> <a id="8553" href="Utils.html#2937" class="Field Operator">←</a> <a id="8555" href="Evaluator.Program.html#4082" class="Function">parsePLC</a> <a id="8564" href="Evaluator.Program.html#8534" class="Bound">namedprog</a>
  <a id="8576" class="Symbol">(</a><a id="8577" href="Evaluator.Program.html#8577" class="Bound">A</a> <a id="8579" href="Evaluator.Program.html#293" class="InductiveConstructor Operator">,,</a> <a id="8582" class="Symbol">_)</a> <a id="8585" href="Utils.html#2937" class="Field Operator">←</a> <a id="8587" href="Utils.html#3696" class="Function">withE</a> <a id="8593" class="Symbol">(λ</a> <a id="8596" href="Evaluator.Program.html#8596" class="Bound">e</a> <a id="8598" class="Symbol">→</a> <a id="8600" href="Evaluator.Base.html#1259" class="InductiveConstructor">typeError</a> <a id="8610" class="Symbol">(</a><a id="8611" href="Evaluator.Base.html#1460" class="Function">uglyTypeError</a> <a id="8625" href="Evaluator.Program.html#8596" class="Bound">e</a><a id="8626" class="Symbol">)</a> <a id="8628" class="Symbol">)</a> <a id="8630" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8632" href="Evaluator.Program.html#4588" class="Function">typeCheckPLC</a> <a id="8645" href="Evaluator.Program.html#8551" class="Bound">t</a>
<a id="8647" class="Comment">{-
  -- some debugging code
  let extricatedtype = extricateScopeTy (extricateNf⋆ A)
  let unshiftedtype = unshifterTy Z extricatedtype
  return (&quot;original: &quot; ++ &quot;???&quot; ++ &quot;\n&quot; ++
          &quot;extricated: &quot; ++ rawTyPrinter extricatedtype ++ &quot;\n&quot; ++
          &quot;unshifted: &quot; ++ rawTyPrinter unshiftedtype ++ &quot;\n&quot; ++
          &quot;unconved: &quot; ++ prettyPrintTy unshiftedtype ++ &quot;\n&quot;)
 -}</a>
  <a id="9027" href="Utils.html#2909" class="Field">return</a> <a id="9034" class="Symbol">(</a><a id="9035" href="Evaluator.Base.html#765" class="Postulate">prettyPrintTy</a> <a id="9049" class="Symbol">(</a><a id="9050" href="Scoped.html#5193" class="Function">unshifterTy</a> <a id="9062" href="Scoped.html#1439" class="InductiveConstructor">Z</a> <a id="9064" class="Symbol">(</a><a id="9065" href="Scoped.html#10960" class="Function">extricateScopeTy</a> <a id="9082" class="Symbol">(</a><a id="9083" href="Scoped.Extrication.html#1316" class="Function">extricateNf⋆</a> <a id="9096" href="Evaluator.Program.html#8577" class="Bound">A</a><a id="9097" class="Symbol">))))</a>
</pre>

    </section>
  </body>
</html>